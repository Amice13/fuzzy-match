var k={mode:"dynamic",maxQueryCache:1e4,ignoreCase:!1,ignoreSymbols:!1,removeDiacritics:!0,normalizeWhitespace:!0,disableNormalization:!1,sort:!1,stringLengthTolerance:.2,hashMinTolerance:4,hashBaseTolerance:16,hashLengthPenalty:2,hashEntropyBoost:4},S=n=>{let{mode:t,data:l,hashMap:a,hashBaseTolerance:c,hashLengthPenalty:i,hashEntropyBoost:h,hashMinTolerance:f,stringLengthTolerance:d}=n;if(t==="static"&&l===void 0&&a===void 0)throw new Error("For static search you must define the initial data or hashMap");if(c!==void 0&&(!Number.isFinite(c)||c<0))throw new Error("Base tolerance must be a non-negative number");if(i!==void 0&&(!Number.isFinite(i)||i<0))throw new Error("Length penalty must be a number and  can't be less than 0");if(h!==void 0&&(!Number.isFinite(h)||h<0))throw new Error("Entropy boost can't be less than 0");if(f!==void 0&&(!Number.isFinite(f)||f<0))throw new Error("Hash tolerance can't be less than 0");if(d!==void 0&&(!Number.isFinite(d)||d<0))throw new Error("String length can't be less than 0");if(d!==void 0&&(!Number.isFinite(d)||d>1))throw new Error("String length can't be greater than 1");return Object.assign({},k,n)};var T=n=>{let t=n.removeDiacritics?/\p{Diacritic}/gu:null,l=n.ignoreSymbols?/[^\p{L}\p{N}\s]+/gu:null,a=n.normalizeWhitespace?/\s+/g:null;return c=>{let i=c.normalize("NFKD");return n.ignoreCase&&(i=i.toLowerCase()),t!==null&&(i=i.replace(t,"")),l!==null&&(i=i.replace(l,"")),a!==null&&(i=i.replace(a," ")),i.trim()}};function O(n){return Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join("")}var A=(()=>{let n=new Uint8Array(256);for(let a=0;a<256;a++)n[a]=a;let t=305419896,l=()=>(t^=t<<13,t^=t>>>17,t^=t<<5,t>>>0&255);for(let a=255;a>0;a--){let c=l()%(a+1);[n[a],n[c]]=[n[c],n[a]]}return n})(),z=(()=>{let n=new Uint8Array(256);for(let t=0;t<256;t++){let l=t,a=0;for(;l!==0;)a++,l&=l-1;n[t]=a}return n})(),U=new Uint8Array(32),b=new Uint32Array(256);function E(n){let t=new TextEncoder().encode(n);b.fill(0);let l=-1,a=-1,c=-1,i=-1,h=t.length,f=(g,e,s,r)=>(A[g+r&255]^A[e]*(r+r+1)^A[s^A[r]])&255;for(let g=0;g<h;g++){let e=t[g];a>-1&&b[f(e,l,a,0)]++,c>-1&&(b[f(e,l,c,1)]++,b[f(e,a,c,2)]++),i>-1&&(b[f(e,l,i,3)]++,b[f(e,a,i,4)]++,b[f(e,c,i,5)]++,b[f(i,l,e,6)]++,b[f(i,c,e,7)]++),i=c,c=a,a=l,l=e}let d=()=>{if(U.fill(0),h<3)return U;let e=(h===3?1:h===4?4:8*h-28)/256;for(let s=0;s<256;s++)b[s]>e&&(U[s>>3]|=1<<(s&7));return U};return{digest:(g="hex")=>{let e=d();return g==="hex"?O(e):e},digestRaw:()=>d()}}function F(n,t){if(n.length!==32||t.length!==32)throw new RangeError("Invalid Nilsimsa buffers");let l=0;for(let a=0;a<32;a++)l+=z[n[a]^t[a]];return 128-l}function H(n,t){let l=[...n],a=[...t],c=l.length,i=a.length;if(c===0||i===0)return 0;let h=Math.floor(Math.max(c,i)/2)-1,f=new Array(c).fill(!1),d=new Array(i).fill(!1),p=0;for(let r=0;r<c;r++){let o=Math.max(0,r-h),m=Math.min(r+h+1,i);for(let u=o;u<m;u++)if(!d[u]&&l[r]===a[u]){f[r]=d[u]=!0,p++;break}}if(p===0)return 0;let x=0;for(let r=0,o=0;r<c;r++)if(f[r]){for(;!d[o];)o++;l[r]!==a[o]&&x++,o++}let g=(p/c+p/i+(p-x/2)/p)/3,e=0,s=4;for(let r=0;r<Math.min(s,c,i)&&l[r]===a[r];r++)e++;return g+e*.1*(1-g)}function I(n){let t=new Map;return{get:h=>{let f=t.get(h);return f!==void 0&&(t.delete(h),t.set(h,f)),f},set:(h,f)=>{if(t.has(h))t.delete(h);else if(t.size>=n){let d=t.keys().next().value;t.delete(d)}t.set(h,f)},has:h=>t.has(h),clear:()=>t.clear()}}var K=4;function M(n){return Math.floor(n/K)}var D=n=>{n!==void 0&&(n=S(n));let t=n.disableNormalization?null:T(n),l=I(n.maxQueryCache),a=n.hashMap??new Map,c=e=>{for(let s of e){let r=M(s.length),o=t!==null?t(s):s,m=E(o).digestRaw(),u=a.get(r);u===void 0&&(u=new Map,a.set(r,u)),u.set(s,m)}};n.data!==void 0&&c(n.data);let i=e=>{let s=M(e.length),r=a.get(s);r===void 0&&(r=new Map,a.set(s,r));let o=r.get(e);if(o===void 0){if(n.mode==="static")return null;let m=t!==null?t(e):e;o=E(m).digestRaw(),r.set(e,o)}return o};function*h(e,s){let r=Math.max(3,Math.floor(e*s)),o=M(Math.max(0,e-r)),m=M(e+r);for(let u=o;u<=m;u++){let w=a.get(u);if(w!==void 0)for(let C of w)yield C}}let f=e=>{let s=l.get(e);if(s===void 0){let r=t!==null?t(e):e;s=E(r).digestRaw(),l.set(e,s)}return s},d=()=>(n.hashMap=a,n),p=(e,s)=>{let r=-1/0,o=[],m=t!==null?t(e):e,u=f(m),w=new Set(m).size/m.length,C=t!==null?t(e):e,L=Math.max(3,Math.floor(e.length*n.stringLengthTolerance)),N;s===void 0?N=h(e.length,n.stringLengthTolerance):N=s.filter(y=>Math.abs(e.length-y.length)<=L).map(y=>[y,i(y)]);let v=Math.max(n.hashMinTolerance,Math.round(n.hashBaseTolerance-Math.log2(C.length+1)*n.hashLengthPenalty+(1-w)*n.hashEntropyBoost));for(let[y,B]of N){if(B===null)continue;let R=F(u,B);if(R>r+v){r=R,o.length=0,o.push(y);continue}Math.abs(R-r)<=v&&o.push(y)}return o},x=(e,s)=>{let r=-1/0,o=[];for(let m of s){let u=H(m,e);if(u>=.98)return{match:[m],score:u};u>r?(r=u,o.length=0,o.push(m)):u===r&&o.push(m)}return{match:o,score:r}};return{search:(e,s)=>{if(s?.includes(e)===!0)return[e];let r=M(e.length);if(a.get(r)?.has(e)===!0)return[e];let o=s??[];if(e.length>3&&(o=p(e,s),o.length===1))return o;let{match:m,score:u}=x(e,o),w=e.length<=4?.9:e.length<=8?.85:.8;return u<w?null:m},getCache:d,setData:c}},ee=D;export{ee as default};
