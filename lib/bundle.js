var z={mode:"dynamic",maxQueryCache:1e4,ignoreCase:!1,ignoreSymbols:!1,removeDiacritics:!0,normalizeWhitespace:!0,disableNormalization:!1,sort:!1,stringLengthTolerance:.2,hashMinTolerance:4,hashBaseTolerance:16,hashLengthPenalty:2,hashEntropyBoost:4},T=o=>{let{mode:e,data:a,hashMap:r,maxQueryCache:s,hashBaseTolerance:i,hashLengthPenalty:h,hashEntropyBoost:u,hashMinTolerance:p,stringLengthTolerance:g}=o;if(e==="static"&&a===void 0&&r===void 0)throw new Error("For static search you must define the initial data or hashMap");if(s!==void 0&&(!Number.isFinite(s)||s<0))throw new Error("Max query cache must be a non-negative number");if(i!==void 0&&(!Number.isFinite(i)||i<0))throw new Error("Base tolerance must be a non-negative number");if(h!==void 0&&(!Number.isFinite(h)||h<0))throw new Error("Length penalty must be a number and  can't be less than 0");if(u!==void 0&&(!Number.isFinite(u)||u<0))throw new Error("Entropy boost can't be less than 0");if(p!==void 0&&(!Number.isFinite(p)||p<0))throw new Error("Hash tolerance can't be less than 0");if(g!==void 0&&(!Number.isFinite(g)||g<0))throw new Error("String length can't be less than 0");if(g!==void 0&&(!Number.isFinite(g)||g>1))throw new Error("String length can't be greater than 1");return Object.assign({},z,o)};var O=o=>{let e=o.removeDiacritics?/\p{Diacritic}/gu:null,a=o.ignoreSymbols?/[^\p{L}\p{N}\s]+/gu:null,r=o.normalizeWhitespace?/\s+/g:null;return s=>{let i=s.normalize("NFKD");return o.ignoreCase&&(i=i.toLowerCase()),e!==null&&(i=i.replace(e,"")),a!==null&&(i=i.replace(a,"")),r!==null&&(i=i.replace(r," ")),i.trim()}};function F(o){return Array.from(o).map(e=>e.toString(16).padStart(2,"0")).join("")}var U=(()=>{let o=new Uint8Array(256);for(let r=0;r<256;r++)o[r]=r;let e=305419896,a=()=>(e^=e<<13,e^=e>>>17,e^=e<<5,e>>>0&255);for(let r=255;r>0;r--){let s=a()%(r+1);[o[r],o[s]]=[o[s],o[r]]}return o})(),K=(()=>{let o=new Uint8Array(256);for(let e=0;e<256;e++){let a=e,r=0;for(;a!==0;)r++,a&=a-1;o[e]=r}return o})(),E=new Uint8Array(32),y=new Uint32Array(256);function C(o){let e=new TextEncoder().encode(o);y.fill(0);let a=-1,r=-1,s=-1,i=-1,h=e.length,u=(b,m,t,n)=>(U[b+n&255]^U[m]*(n+n+1)^U[t^U[n]])&255;for(let b=0;b<h;b++){let m=e[b];r>-1&&y[u(m,a,r,0)]++,s>-1&&(y[u(m,a,s,1)]++,y[u(m,r,s,2)]++),i>-1&&(y[u(m,a,i,3)]++,y[u(m,r,i,4)]++,y[u(m,s,i,5)]++,y[u(i,a,m,6)]++,y[u(i,s,m,7)]++),i=s,s=r,r=a,a=m}let p=()=>{if(E.fill(0),h<3)return E;let m=(h===3?1:h===4?4:8*h-28)/256;for(let t=0;t<256;t++)y[t]>m&&(E[t>>3]|=1<<(t&7));return E};return{digest:(b="hex")=>{let m=p();return b==="hex"?F(m):m},digestRaw:()=>p()}}function H(o,e){if(o.length!==32||e.length!==32)throw new RangeError("Invalid Nilsimsa buffers");let a=0;for(let r=0;r<32;r++)a+=K[o[r]^e[r]];return 128-a}function I(o,e){let a=[...o],r=[...e],s=a.length,i=r.length;if(s===0||i===0)return 0;let h=Math.floor(Math.max(s,i)/2)-1,u=new Array(s).fill(!1),p=new Array(i).fill(!1),g=0;for(let n=0;n<s;n++){let c=Math.max(0,n-h),l=Math.min(n+h+1,i);for(let f=c;f<l;f++)if(!p[f]&&a[n]===r[f]){u[n]=p[f]=!0,g++;break}}if(g===0)return 0;let M=0;for(let n=0,c=0;n<s;n++)if(u[n]){for(;!p[c];)c++;a[n]!==r[c]&&M++,c++}let b=(g/s+g/i+(g-M/2)/g)/3,m=0,t=4;for(let n=0;n<Math.min(t,s,i)&&a[n]===r[n];n++)m++;return b+m*.1*(1-b)}function L(o){let e=new Map;return{get:h=>{let u=e.get(h);return u!==void 0&&(e.delete(h),e.set(h,u)),u},set:(h,u)=>{if(e.has(h))e.delete(h);else if(e.size>=o){let p=e.keys().next().value;e.delete(p)}e.set(h,u)},has:h=>e.has(h),clear:()=>e.clear()}}var D=4;function A(o){return Math.floor(o/D)}var j=o=>{let e=T(o??{}),a=e.disableNormalization?null:O(e),r=L(e.maxQueryCache),s=e.hashMap??new Map,i=t=>{for(let n of t){let c=A(n.length),l=a!==null?a(n):n,f=C(l).digestRaw(),d=s.get(c);d===void 0&&(d=new Map,s.set(c,d)),d.set(n,f)}};e.data!==void 0&&i(e.data);let h=t=>{let n=A(t.length),c=s.get(n);c===void 0&&(c=new Map,s.set(n,c));let l=c.get(t);if(l===void 0){if(e.mode==="static")return null;let f=a!==null?a(t):t;l=C(f).digestRaw(),c.set(t,l)}return l};function*u(t,n){let c=Math.max(3,Math.floor(t*n)),l=A(Math.max(0,t-c)),f=A(t+c);for(let d=l;d<=f;d++){let x=s.get(d);if(x!==void 0)for(let N of x)yield N}}let p=t=>{let n=r.get(t);if(n===void 0){let c=a!==null?a(t):t;n=C(c).digestRaw(),r.set(t,n)}return n},g=()=>(e.hashMap=s,e),M=(t,n)=>{let c=-1/0,l=[],f=a!==null?a(t):t,d=p(f),x=new Set(f).size/f.length,N=a!==null?a(t):t,k=Math.max(3,Math.floor(t.length*e.stringLengthTolerance)),v;n===void 0?v=u(t.length,e.stringLengthTolerance):v=n.filter(w=>Math.abs(t.length-w.length)<=k).map(w=>[w,h(w)]);let S=Math.max(e.hashMinTolerance,Math.round(e.hashBaseTolerance-Math.log2(N.length+1)*e.hashLengthPenalty+(1-x)*e.hashEntropyBoost));for(let[w,B]of v){if(B===null)continue;let R=H(d,B);if(R>c+S){c=R,l.length=0,l.push(w);continue}Math.abs(R-c)<=S&&l.push(w)}return l},b=(t,n)=>{let c=-1/0,l=[];for(let f of n){let d=I(f,t);if(d>=.98)return{match:[f],score:d};d>c?(c=d,l.length=0,l.push(f)):d===c&&l.push(f)}return{match:l,score:c}};return{search:(t,n)=>{if(typeof t!="string")throw Error("Source is not a string");if(n?.includes(t)===!0)return[t];let c=A(t.length);if(s.get(c)?.has(t)===!0)return[t];let l=n??[];if(t.length>3&&(l=M(t,n),l.length===1))return l;let{match:f,score:d}=b(t,l),x=t.length<=4?.9:t.length<=8?.85:.8;return d<x?null:f},getCache:g,setData:i}},te=j;export{te as default};
